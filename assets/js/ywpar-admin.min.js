jQuery(document).ready(function(a){"use strict";var b=a(document).find("#yit_ywpar_options_extra_points-container"),c=b.find(".ywpar-section"),d=c.find(".section-head"),e=d.find(".ywpar-remove"),f=d.find(".ywpar-active"),g=c.find(".yith-ywpar-eventype-select"),h="undefined"!=typeof yith_ywpar_admin&&yith_ywpar_admin.block_loader,i="undefined"!=typeof yith_ywpar_admin&&yith_ywpar_admin.error_msg,j="undefined"!=typeof yith_ywpar_admin&&yith_ywpar_admin.del_msg,k=b.find("#yith-ywpar-add-section"),l=b.find("#yith-ywpar-add-section-button"),m=function(b){b.on("click",function(b){b.stopPropagation();var c=a(this),d=c.data("section"),e=c.parents(".ywpar-section"),f=window.confirm(j);1==f&&(h&&e.block({message:null,overlayCSS:{background:"#fff url("+h+") no-repeat center",opacity:.5,cursor:"none"}}),a.post(yith_ywpar_admin.ajaxurl,{action:"yith_dynamic_pricing_section_remove",section:d},function(a){e.remove()}))})},n=function(b){b.on("click",function(b){b.stopPropagation();var c=a(this),e=(c.data("section"),c.parents(".section-head").find(".active-hidden-field"));c.hasClass("activated")?(c.removeClass("activated"),e.val("no")):(c.addClass("activated"),e.val("yes"))})},o=function(b){b.each(function(){var b=a(this),c=b.data("field"),d=b.find("option:selected");p(b,d.val(),c),b.on("change",function(){c=b.data("field"),d=b.find("option:selected"),p(b,d.val(),c)})})},p=function(b,c,d){var e=b.parents(".ywpar-select-wrapper").find("tr.deps-"+d);e.each(function(){var b=a(this).data("type").split(";");if(a.inArray(c,b)!==-1)a(this).show();else if(a(this).hide(),"undefined"!=typeof a(this).data("rel")){var d="deps-"+a(this).data("rel");a(this).parents(".ywpar-section").find("."+d).hide()}})},q=function(b){b.ajaxChosen({method:"GET",url:yith_ywpar_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"woocommerce_json_search_products",security:yith_ywpar_admin.search_products_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})},r=function(b){b.ajaxChosen({method:"GET",url:yith_ywpar_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"ywpar_category_search",security:yith_ywpar_admin.search_categories_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})},s=function(b){b.ajaxChosen({method:"GET",url:yith_ywpar_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"ywpar_customer_search",security:yith_ywpar_admin.search_customers_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})};l.on("click",function(c){c.preventDefault();var d=a(this),e=d.data("section_id"),f=d.data("section_name"),g=d.data("action"),h=k.val();""==h?i&&d.siblings(".ywpar-error-input-section").html(i):a.post(yith_ywpar_admin.ajaxurl,{action:g,section:h,id:e,name:f},function(c){k.val(""),a(".ywpar-error-input-section").remove(),b.append(c);var d=b.find(".ywpar-section").last(),f=(a(d).find(".section-head"),d.find(".yith-ywpar-eventype-select")),g=d.find(".ywpar-active"),h=d.find(".ywpar-remove");d.find("select").chosen({width:"100%",disable_search:!0}),o(f),m(h),n(g),d.find(".ajax_chosen_select_categories").each(function(){r(a(this))}),d.find(".ajax_chosen_select_products").each(function(){q(a(this))}),d.find(".ajax_chosen_select_customers").each(function(){s(a(this))}),d.find(".datepicker").datepicker({dateFormat:"yy-mm-dd"})})}),a(document).on("click",".ywpar-add-row",function(){var b=a(this),c=b.closest("table"),d=b.closest("tr"),e=parseInt(d.data("index")),f=d.clone(),g=c.find("tr"),h=1;g.each(function(){var b=a(this).data("index");b>h&&(h=b)});var i=h+1;f.attr("data-index",i);var j=f.find("[name*='extra_points']");j.each(function(){var b=a(this),c=b.attr("name"),d=b.attr("id"),f=c.replace("[extra_points]["+e+"]","[extra_points]["+i+"]"),g=d.replace("[extra_points]["+e+"]","[extra_points]["+i+"]");b.attr("name",f),b.attr("id",g),b.val("")}),f.find(".remove-row").removeClass("hide-remove"),f.find(".chosen-container").remove(),f.find("select").chosen({width:"100%",disable_search:!1}),c.append(f);var k=f.find(".yith-ywpar-eventype-select"),l=f.parents(".ywpar-section");l.find(".ajax_chosen_select_categories").each(function(){r(a(this))}),l.find(".ajax_chosen_select_products").each(function(){q(a(this))}),l.find(".ajax_chosen_select_customers").each(function(){s(a(this))}),o(k)}),a(document).on("click","#yit_ywpar_options_extra_points-container .remove-row",function(){var b=a(this),c=b.closest("tr");c.remove()}),m(e),n(f),o(g),c.find(".ajax_chosen_select_categories").each(function(){r(a(this))}),c.find(".ajax_chosen_select_products").each(function(){q(a(this))}),c.find(".ajax_chosen_select_customers").each(function(){s(a(this))}),c.find("select").chosen({width:"100%",disable_search:!1}),c.find(".datepicker").datepicker({dateFormat:"yy-mm-dd"}),a(".ywpar_point_earned_dates_fields").each(function(){var b=a(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(c){var d="",e=a(this).data("datepicker"),f=a.datepicker.parseDate(e.settings.dateFormat||a.datepicker._defaults.dateFormat,c,e.settings);b.not(this).datepicker("option",d,f)}})}),a(".plugin-option .yit_options .panel-datepicker").each(function(){a(this).datepicker({dateFormat:"yy-mm-dd"})}),a("#yit_ywpar_options_apply_points_previous_order_btn").on("click",function(b){b.preventDefault();var c=a(this).prev().val(),d=a("#yit_ywpar_options_apply_points_previous_order-container .option");d.find(".response").remove(),h&&d.block({message:null,overlayCSS:{background:"transparent",opacity:.5,cursor:"none"}}),a.ajax({type:"POST",url:yith_ywpar_admin.ajaxurl,dataType:"json",data:"action=ywpar_apply_previous_order&from="+c+"&security="+yith_ywpar_admin.apply_previous_order_none,success:function(a){d.unblock(),d.append('<span class="response">'+a+"</span>")}})}),a(".ywrac_reset_points").on("click",function(b){b.preventDefault();var c=confirm(yith_ywpar_admin.reset_points_confirm);if(!c)return!1;var d=a("#yit_ywpar_options_reset_points-container .option");d.find(".response").remove(),h&&d.block({message:null,overlayCSS:{background:"transparent",opacity:.5,cursor:"none"}}),a.ajax({type:"POST",url:yith_ywpar_admin.ajaxurl,dataType:"json",data:"action=ywpar_reset_points&security="+yith_ywpar_admin.reset_points,success:function(a){d.unblock(),d.append('<span class="response">'+a+"</span>")}})}),a("#yit_ywpar_options_apply_points_from_wc_points_rewards_btn").on("click",function(b){b.preventDefault();var c=a(this).prev().val(),d=a("#yit_ywpar_options_apply_points_from_wc_points_rewards-container .option");d.find(".response").remove(),h&&d.block({message:null,overlayCSS:{background:"transparent",opacity:.5,cursor:"none"}}),a.ajax({type:"POST",url:yith_ywpar_admin.ajaxurl,dataType:"json",data:"action=ywpar_apply_wc_points_rewards&from="+c+"&security="+yith_ywpar_admin.apply_wc_points_rewards,success:function(a){d.unblock(),d.append('<span class="response">'+a+"</span>")}})});var t=a("#yit_ywpar_options_conversion_rate_method"),u=function(b){"fixed"==b?(a(document).find('input[data-hide="percentage_method"]').closest("tr").hide(),a(document).find(".percentual_method").closest("tr").hide(),a(document).find('input[data-hide="fixed_method"]').closest("tr").show(),a(document).find(".fixed_method").closest("tr").show()):"none"==b?(a(document).find('input[data-hide="percentage_method"]').closest("tr").hide(),a(document).find(".percentual_method").closest("tr").hide(),a(document).find('input[data-hide="fixed_method"]').closest("tr").hide(),a(document).find(".fixed_method").closest("tr").hide()):"percentage"==b&&(a(document).find('input[data-hide="percentage_method"]').closest("tr").show(),a(document).find(".percentual_method").closest("tr").show(),a(document).find('input[data-hide="fixed_method"]').closest("tr").hide(),a(document).find(".fixed_method").closest("tr").hide())};u(t.val()),t.on("change",function(){var b=a(this).val();u(b)}),a("#ywpar_import_points").length&&a("#ywpar_import_points").closest("form").attr("enctype","multipart/form-data"),a("#ywpar_import_points").on("click",function(b){b.preventDefault(),a(".ywpar_safe_submit_field").val("import_points"),a(this).closest("form").submit()})});